package com.crafter6464.endercraft.machines.ender_furnace;

import net.minecraft.block.Block;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.entity.player.InventoryPlayer;
import net.minecraft.init.Blocks;
import net.minecraft.init.Items;
import net.minecraft.inventory.Container;
import net.minecraft.inventory.ISidedInventory;
import net.minecraft.item.Item;
import net.minecraft.item.ItemBlock;
import net.minecraft.item.ItemStack;
import net.minecraft.item.crafting.FurnaceRecipes;
import net.minecraft.server.gui.IUpdatePlayerListBox;
import net.minecraft.util.EnumFacing;

import com.crafter6464.endercraft.handler.ConfigurationHandler;
import com.crafter6464.endercraft.machines.abstractmachines.ECTileEntity;
import com.crafter6464.endercraft.utility.Log;

public class TileEntityEnderFurnace extends ECTileEntity implements IUpdatePlayerListBox,ISidedInventory {
	public int burnTime;
	public int furnaceSpeed=ConfigurationHandler.enderFurnaceSpeed;
	public int currentItemBurnTime;
	public int cookTime;
	
	
	public TileEntityEnderFurnace() {
		super(3,"EnderFurnace");
		
	}

	@Override
	public Container createContainer(InventoryPlayer playerInventory,
			EntityPlayer playerIn) {
		// TODO Auto-generated method stub
		return new ContainerEnderFurnace(playerInventory, this);
	}



	@Override
	public boolean hasCustomName() {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public ItemStack getStackInSlotOnClosing(int index) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public void openInventory(EntityPlayer player) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void closeInventory(EntityPlayer player) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public boolean isItemValidForSlot(int index, ItemStack stack) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public int getField(int id) {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public void setField(int id, int value) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public int getFieldCount() {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public int[] getSlotsForFace(EnumFacing side) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public boolean canInsertItem(int index, ItemStack itemStackIn,
			EnumFacing direction) {
		// TODO Auto-generated method stub
		return false;
	}

	@Override
	public boolean canExtractItem(int index, ItemStack stack,
			EnumFacing direction) {
		// TODO Auto-generated method stub
		return true;
	}
	public boolean shouldUpdate(){
		if(this.burnTime>0)return true;
		if(canSmelt()){
			if(this.slots[1]!=null){
			return true;
		}
		}
		return false;
	}
	public void doUpdate(){
		Ender_Furnace.updateState(canSmelt() || this.burnTime>0, worldObj, this, pos);

	}
public void updateState(){
	if(this.burnTime > 0){
doUpdate();
	}
	else{
		if(canSmelt() && this.slots[1]!=null){
			doUpdate();
		}
	}
}
	@Override
	public void update() {
		doUpdate();
		
			Log.info(this.burnTime);
		
//	Log.info(burnTime);
		//check if burn time should be increased
		if(this.slots[0]==null){
			this.cookTime=0;
		}
		
if(canSmelt()){
	if(this.burnTime<=0){
		this.cookTime=0;
		if(this.slots[1]!=null){
		
		if(this.slots[1].getItem() != Items.lava_bucket){
			this.slots[1].stackSize--;
		this.currentItemBurnTime = this.burnTime = getItemBurnTime(this.slots[1]); 
		if(this.slots[1].stackSize<=0)this.slots[1]=null;
		}
		else{
			this.currentItemBurnTime = this.burnTime = getItemBurnTime(this.slots[1]); 
			this.slots[1] =null;
			this.slots[1] =new ItemStack(Items.bucket,1);
			

		}
	}
}
	else
	{
		this.burnTime--;
	}
	
	if(canSmelt()){
		if(this.burnTime>=1){
		this.cookTime++;
	}
		else{
			this.cookTime=0;
		}
		
		if(this.cookTime == this.furnaceSpeed){
			this.cookTime=0;
			if(canSmelt()){
				this.smeltItem();
			}
		}
	}
}		
	}
private int getItemBurnTime(ItemStack itemStack) {
		if(itemStack.getItem() instanceof ItemBlock){
			Item item = itemStack.getItem();
			if(Block.getBlockFromItem(item) != Blocks.air){
				Block block = Block.getBlockFromItem(item);
				
				if(block == Blocks.coal_block) return 16000;
				if(block == Blocks.sapling) return 100;
				if(block == Blocks.planks) return 400;
				if(block == Blocks.log || block == Blocks.log2) return 1600;
			}
		}else if(itemStack.getItem() instanceof Item){
			Item item = itemStack.getItem();
			if(item == Items.coal)return 8000;
			if(item == Items.lava_bucket)return 100000;
			if(item == Items.ender_pearl) return 150000;
			
			
		}
		return 0;
	}

public boolean canSmelt(){
	if(this.slots[0]==null)return false;
	if(FurnaceRecipes.instance().getSmeltingResult(this.slots[0])!=null){
	ItemStack resultStack = FurnaceRecipes.instance().getSmeltingResult(this.slots[0]);
	if(this.slots[2]==null)return true;
	if(this.slots[2].stackSize + resultStack.stackSize <=64)return true;
}
	return false;
}
public boolean isActive(){
	return this.burnTime>0;
}

public void smeltItem(){
	ItemStack resultStack = FurnaceRecipes.instance().getSmeltingResult(this.slots[0]);
	if(this.slots[2]==null){
		this.slots[2] = resultStack.copy();
		this.slots[0].stackSize--;
		if(this.slots[0].stackSize<=0){
			this.slots[0]=null;
		}
	}
	else
	{
		this.slots[2].stackSize += resultStack.stackSize;
		this.slots[0].stackSize--;
		if(this.slots[0].stackSize<=0){
			this.slots[0]=null;
		}
	}
}
public int getBurnTimeRemainingScaled(int i) {
	return this.burnTime * i / this.currentItemBurnTime;
}
public int getCookTimeRemainingScaled(int modifier){
	return this.cookTime* modifier/this.furnaceSpeed ;
}
public boolean isItemFuel(ItemStack stack){
	return this.getItemBurnTime(stack) > 0;
}

}
